{
    "componentChunkName": "component---src-templates-post-js",
    "path": "/post/Node-MongoDB-CRUD",
    "result": {"data":{"markdownRemark":{"frontmatter":{"title":"Node-MongoDB CRUD","date":"March 5th, 2019"},"html":"<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 512px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 100%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAA3XAAAN1wFCKJt4AAAEFUlEQVQ4y3WU30scVxTHJwnpa/+AQIp9E8SHfVC0rUQ0ULGrddsKISYN0irUBCOVmIc0WkVLILZQg6UhRBKKpQnUSFNNf5Jt2qht1pjaRo1Zt66jrmbXmXN2dtbdnb3fcsdZOy8dONy7e+98zvfOPeerEJHCzDL2OKOMA8x8lojuMnOEmTNElGbmFWYeJ6L3mPl5uZeI9khGLhQHuNdZlPMzRKQzM9xBRHa45iozH3OJsMG7EyLaz8yjuReYWSqymFkQkZAjM2eJKGMYRsaVYCAnxq1QxqizSYKyjrIcyIbmwOvr6zBN04rH4xkH+rHD2KsYhqFomnbGWUg5L2EXQP8dV9M0ZLNZ0d/fL9rb25FIJOReS65tbW3VSaiyvLx8wDRNXdd16LpuK9NJt6FG3ICma7vAaDQK+fT19aGgoEDEYjHkgKZpPh4aGtqvADirqiqSyWR6e3vbhqXMtA1af7aGdDJjX4RhGEin04jH4+jp6UFJSQlisZiwLEuuWeqqKnP5lI6ODn9xcTFaW1ut+YV5kTAS4lFoGhfGz+H9r5rwbeCWTIKNjQ0MDAygtLQURUVFqKiokIrF7OysaGxszJS9Uobz5z+4qng8ns22tjZ4PB5x9EiDCEWCaL3xNt69/iZaho+i7tMK/DT3Az4fvIyDLxxEc3MzysvLUVlZiXA4jKqqKlHyUonVcKIBeXl5U4rX681KrSdPnRR1NT4xp/6FY9dfx6nh42i/+Q7e+uxV3AzcwMWPLqKouAjys/T29toql0JLOFR2SHR82CHuLd3FlctX4kpTU5MlgV1dXaLmtRrxTySEmkvVqL1UiZbhIzhxtRbTy79j+NqXyHsxD9XV1SgsLITP50MkEkF9fb3Iz88X3d3dUvGmEolEVPnBo9Fo1v+LX2gxDYvqInpGO3Fh7BwCwUn8GZrBovoEY7fH4PV6ZXKsrKzIm5UQ0dnZadXW1mJkZMQv6/COvHZZpKlUShCT2E5sI2WmEFoPYerJJB6H/8Yfi1N4tDKD6FbUvm0zacoyE8lkUqRSKbvAs9nsoKLreotTyBlZi7KYZckkDBP353+zYfce+/Hz7I/4fuYOgmtBGLxTn7JrJFTXddmisowOK45rrDqdYu0UsS4S8YStSh71i1+vYfTB1xh/eBtLa0HINaeT4DiR/D2haZqS6+Pjzp8ZOyvpMA1TPAxOi+9mxhB4+gDTwQC+CdxCeCMsk+VgWZeZvGy3nvQzBzrgUmnlzOHp6qKYXLgvJhcmhLqpCiNu5Ewi44Kddhj7FJcPyvjE5X8SmjEN04ppMRuSMBKWcwrLZV+nc0ZrK3SbozP3EdHc/5iqez4hj+n44K7bK277ln7mjM8R0RtENMTME7TzPGNmPxENEtFhl4B9LtdW/gV3cBpX/1VxkgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"nodejs\"\n        title=\"nodejs\"\n        src=\"/static/55e83371dbf50a5f027b1fe31a054ad3/01e7c/nodejs.png\"\n        srcset=\"/static/55e83371dbf50a5f027b1fe31a054ad3/4dcb9/nodejs.png 188w,\n/static/55e83371dbf50a5f027b1fe31a054ad3/5ff7e/nodejs.png 375w,\n/static/55e83371dbf50a5f027b1fe31a054ad3/01e7c/nodejs.png 512w\"\n        sizes=\"(max-width: 512px) 100vw, 512px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h3>SQL과 NoSQL</h3>\n<hr>\n<p><strong>SQL(Structured Query Language)</strong></p>\n<ul>\n<li>table 단위</li>\n<li>1개의 정보(튜플) = row 또는 record</li>\n<li>attribute를 Column이라고 한다.</li>\n</ul>\n<p><strong>NoSQL(Not Only SQL)</strong></p>\n<ul>\n<li>collection 단위</li>\n<li>1개의 정보(튜플) = document</li>\n<li>attribute를 field라고 한다.</li>\n</ul>\n<h3>Installing MongoDB</h3>\n<hr>\n<p>v4.0.4이고 MacOS이기 때문에 편하게 homebrew로 설치한다.</p>\n<p>ROBO 3T라는 GUI tool을 다운로드했다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 36.702127659574465%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAABWElEQVQoz12Ra2/iMBBF8///Dp9KA2VboBQElFVJMUka8touXepkwyMQQKcaS6DdWjry2NK9c8e2nsd9xj/HOC9TXM/H933CMCSKIrPHccwiXFxrIUmE5D/SNCVNEyxHuQwGA97ff7FarWjetajVatzaNzSbNvV6nVu7gW036HQf6XS7tDsdHtoX2tw/tGm0Wty1fmAFYUS390QcRcZw7s5xHIeZmuH7Hp7vM51ODa7ropQiWCwIgsBMJInDMMJRc5SaY8W///Dyqvj4WKK1pihyI/pcfZrzer0248gT7Pd7ttstp9OJqjpS7kq+L0vrDJ1lZFlGnuekyRv9fp/RaMRwOGQymeB5HsvlkvP5zOFwoKoq0yjP/5qzNLpgZVqbJEKeZ8SRZ4zEtNfrmVo+SlKKoYjEUJIWRcHxeLw2ESz9j6Gk3O22bDabKyIsy9IYifgiFMTo+90Xf+YBisg682YAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image-20190305234422235\"\n        title=\"image-20190305234422235\"\n        src=\"/static/729fb046578dd743b79bf01a9d6aec23/1d69c/image-20190305234422235.png\"\n        srcset=\"/static/729fb046578dd743b79bf01a9d6aec23/4dcb9/image-20190305234422235.png 188w,\n/static/729fb046578dd743b79bf01a9d6aec23/5ff7e/image-20190305234422235.png 375w,\n/static/729fb046578dd743b79bf01a9d6aec23/1d69c/image-20190305234422235.png 750w,\n/static/729fb046578dd743b79bf01a9d6aec23/78797/image-20190305234422235.png 1125w,\n/static/729fb046578dd743b79bf01a9d6aec23/aa440/image-20190305234422235.png 1500w,\n/static/729fb046578dd743b79bf01a9d6aec23/e80ec/image-20190305234422235.png 2582w\"\n        sizes=\"(max-width: 750px) 100vw, 750px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>(이러한 GUI를 제공해준다. 명령어 또한 보여주기 때문에 공부도 된다.)</p>\n<h3>Connecting and Inserting Documents</h3>\n<hr>\n<p>mongodb 연결하기</p>\n<p>mongodb.js</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> mongodb <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'mongodb'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> MongoClient <span class=\"token operator\">=</span> mongodb<span class=\"token punctuation\">.</span>MongoClient\n\n<span class=\"token keyword\">const</span> connectionURL <span class=\"token operator\">=</span> <span class=\"token string\">'mongodb://127.0.0.1:27017'</span>\n<span class=\"token keyword\">const</span> database <span class=\"token operator\">=</span> <span class=\"token string\">'task-manager'</span>\n\nMongoClient<span class=\"token punctuation\">.</span><span class=\"token function\">connect</span><span class=\"token punctuation\">(</span>connectionURL<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">useNewUrlParser</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">error<span class=\"token punctuation\">,</span> client</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span> <span class=\"token comment\">// option useNewUrlParser: true</span>\n  <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'unable to connect to database'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'connected correctly'</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//callback</span></code></pre></div>\n<p>이후 새로운 데이터베이스를 만들고 컬렉션을 생성하고 추가하는 작업에서 인증 문제로 인해 막혔다.</p>\n<p>이에 대해 몽고디비 공식문서에서 해결책을 찾아냈다.</p>\n<p>(<a href=\"http://mongodb.github.io/node-mongodb-native/2.0/reference/connecting/authenticating/\">http://mongodb.github.io/node-mongodb-native/2.0/reference/connecting/authenticating/</a>)</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> connectionURL <span class=\"token operator\">=</span> <span class=\"token string\">'mongodb://csheum:&lt;password>@127.0.0.1:27017'</span></code></pre></div>\n<p>url로 아이디와 패스워드를 넘겨준다.</p>\n<p>(실제 배포에 있어서는 보안문제가 발생할 수 있으므로, dotenv를 사용하자.)</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// CRUD</span>\n\n<span class=\"token keyword\">const</span> mongodb <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'mongodb'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> MongoClient <span class=\"token operator\">=</span> mongodb<span class=\"token punctuation\">.</span>MongoClient\n\n<span class=\"token keyword\">const</span> connectionURL <span class=\"token operator\">=</span> <span class=\"token string\">'mongodb://csheum:password@127.0.0.1:27017'</span>\n<span class=\"token keyword\">const</span> databaseName <span class=\"token operator\">=</span> <span class=\"token string\">'task-manager'</span>\n\n\nMongoClient<span class=\"token punctuation\">.</span><span class=\"token function\">connect</span><span class=\"token punctuation\">(</span>connectionURL<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">useNewUrlParser</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">error<span class=\"token punctuation\">,</span> client</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span> <span class=\"token comment\">// option useNewUrlParser: true</span>\n  <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'unable to connect to database'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n  \n  <span class=\"token keyword\">const</span> db <span class=\"token operator\">=</span> client<span class=\"token punctuation\">.</span><span class=\"token function\">db</span><span class=\"token punctuation\">(</span>databaseName<span class=\"token punctuation\">)</span>\n  \n  db<span class=\"token punctuation\">.</span><span class=\"token function\">collection</span><span class=\"token punctuation\">(</span><span class=\"token string\">'users'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">insertOne</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">'Nailer'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">age</span><span class=\"token operator\">:</span> <span class=\"token string\">'25'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token comment\">// callback</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">//callback</span>\n </code></pre></div>\n<p>그 결과</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 13.297872340425531%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAp0lEQVQI1z2Oyw6CMAAE+f8fQz1yUomS8iq0gRYohBLCmBL1MJfNZnei6yVGyobBWpTWiFxQS8nr/UYpxTAMGGMYx5G+77HW4r1nXVd8wHuWZWGZZ7quI4qvN9L0iZQSpVqM0WRZRtu21HVNVVXkeY7WmqIoSJKEpmnOPFCWJc45tm1DKU30fNzP52AxTRPOzQghzsK+73+O4zhPg0UwCt0f69c0bHwAbyvhyn+21KEAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image-20190305235142548\"\n        title=\"image-20190305235142548\"\n        src=\"/static/52726f45de32e22de925659e9b8e5491/1d69c/image-20190305235142548.png\"\n        srcset=\"/static/52726f45de32e22de925659e9b8e5491/4dcb9/image-20190305235142548.png 188w,\n/static/52726f45de32e22de925659e9b8e5491/5ff7e/image-20190305235142548.png 375w,\n/static/52726f45de32e22de925659e9b8e5491/1d69c/image-20190305235142548.png 750w,\n/static/52726f45de32e22de925659e9b8e5491/78797/image-20190305235142548.png 1125w,\n/static/52726f45de32e22de925659e9b8e5491/5f652/image-20190305235142548.png 1302w\"\n        sizes=\"(max-width: 750px) 100vw, 750px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>insertOne method의 error처리와 결과 확인</p>\n<h2>Create</h2>\n<hr>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">db<span class=\"token punctuation\">.</span><span class=\"token function\">collection</span><span class=\"token punctuation\">(</span><span class=\"token string\">'users'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">insertOne</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">'Nailer'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">age</span><span class=\"token operator\">:</span> <span class=\"token string\">'25'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">error<span class=\"token punctuation\">,</span> result</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n      console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'unable to insert document'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">.</span>ops<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token comment\">// callback</span></code></pre></div>\n<p>1번째 인자는 error, 2번째 인자는 result이다.</p>\n<p>result.ops에서 ops는 document를 array로 보여준다.</p>\n<p>지금은 1개의 document만 넣었기 때문에 1개만 보인다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">[ { name: 'Nailer', age: '25', _id: 5c7b955376ddba7f45a360ac } ]</code></pre></div>\n<p>여러 document를 create할 때 insertMany method를 사용한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">db<span class=\"token punctuation\">.</span><span class=\"token function\">collection</span><span class=\"token punctuation\">(</span><span class=\"token string\">'users'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">insertMany</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">'hyuk'</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">age</span><span class=\"token operator\">:</span> <span class=\"token number\">25</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">'jun'</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">age</span><span class=\"token operator\">:</span> <span class=\"token number\">25</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">error<span class=\"token punctuation\">,</span> result</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'unable to insert them'</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span>\n      console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">.</span>ops<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p><a href=\"http://mongodb.github.io\">http://mongodb.github.io</a></p>\n<p>mongodb API doc. 확인하는 곳! 다양한 옵션들을 확인한다.</p>\n<p><strong>MongoDB의 큰 특징 중 하나로 ObjectId는 mongodb에 의해 자동으로 생성된다.</strong></p>\n<ul>\n<li>mysql의 auto increment 되는 id와 달리 GUID(Globally Unique Identifier,)를 사용하여  편리하다.</li>\n<li>총 12byte짜리 정보이며 순서대로\n<ul>\n<li>4byte는 UNIX 시간</li>\n<li>5byte는 random value</li>\n<li>3byte는 random value로 시작하는 counter</li>\n</ul>\n</li>\n</ul>\n<p><a href=\"https://docs.mongodb.com/manual/reference/method/ObjectId/\">https://docs.mongodb.com/manual/reference/method/ObjectId/</a></p>\n<p>(ObjectID에 대한 설명)</p>\n<h2>Read</h2>\n<hr>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">db<span class=\"token punctuation\">.</span><span class=\"token function\">collection</span><span class=\"token punctuation\">(</span><span class=\"token string\">'users'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">findOne</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">'jun'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">age</span><span class=\"token operator\">:</span> <span class=\"token number\">21</span><span class=\"token punctuation\">,</span>  \n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">error<span class=\"token punctuation\">,</span> user</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n      console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'unable to fetch'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>탐색결과가 없더라도 탐색 자체의 error가 아니면 error 처리되지 않고 null이 출력됨.</p>\n<p>ObjectID를 이용한 탐색</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">db<span class=\"token punctuation\">.</span><span class=\"token function\">collection</span><span class=\"token punctuation\">(</span><span class=\"token string\">'users'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">findOne</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">_id</span><span class=\"token operator\">:</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ObjectID</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"5c7b99ce6bafd9a6fb696a4f\"</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 그냥 스트링으로 들어가면 안되고 ObjectID 타입으로</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">error<span class=\"token punctuation\">,</span> user</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n      console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'unable to fetch'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p><strong>promise와 callback에 대하여</strong></p>\n<p>callback.js</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">doWorkCallBack</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">callback</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">callback</span><span class=\"token punctuation\">(</span><span class=\"token string\">'This is my error'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">undefined</span><span class=\"token punctuation\">)</span> \n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2000</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token function\">doWorkCallBack</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">error<span class=\"token punctuation\">,</span> result</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> \n  <span class=\"token punctuation\">}</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n</code></pre></div>\n<p>promise.js</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'promise.js is running'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> doWorkPromise <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve<span class=\"token punctuation\">,</span> reject</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">reject</span><span class=\"token punctuation\">(</span><span class=\"token string\">'well...'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token comment\">//resolve([7, 4, 1])</span>\n    \n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2000</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\ndoWorkPromise\n  <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">result</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"success\"</span><span class=\"token punctuation\">,</span> result<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">error</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n</code></pre></div>\n<h2>Update</h2>\n<hr>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> updatePromise <span class=\"token operator\">=</span> db<span class=\"token punctuation\">.</span><span class=\"token function\">collection</span><span class=\"token punctuation\">(</span><span class=\"token string\">'users'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">updateOne</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n     <span class=\"token literal-property property\">_id</span><span class=\"token operator\">:</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ObjectID</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"5c7b99ce6bafd9a6fb696a4f\"</span><span class=\"token punctuation\">)</span> \n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">$set</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">'junijuni'</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  updatePromise<span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">result</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">error</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>updateOne method를 사용하였고, 예상과 다른점은</p>\n<p>2번째 argument로 $set 안에 update할 attribute와 그 내용을 넣는다는 점이다. $set은 다양한 operator 중 하나이다. 아래 목록이 있다.</p>\n<p>이후 update가 성공적인지 확인하기 위해 updatePromise를 통해 결과를 확인하면 시행한 update에 대한 매우 긴 정보가 들어있다.</p>\n<p><strong>mongodb update operators</strong></p>\n<p>다양한 옵션들이 있다.</p>\n<table>\n<thead>\n<tr>\n<th>Name</th>\n<th>Description</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><a href=\"https://docs.mongodb.com/manual/reference/operator/update/currentDate/#up._S_currentDate\"><code class=\"language-text\">$currentDate</code></a></td>\n<td>Sets the value of a field to current date, either as a Date or a Timestamp.</td>\n</tr>\n<tr>\n<td><a href=\"https://docs.mongodb.com/manual/reference/operator/update/inc/#up._S_inc\"><code class=\"language-text\">$inc</code></a></td>\n<td>Increments the value of the field by the specified amount.</td>\n</tr>\n<tr>\n<td><a href=\"https://docs.mongodb.com/manual/reference/operator/update/min/#up._S_min\"><code class=\"language-text\">$min</code></a></td>\n<td>Only updates the field if the specified value is less than the existing field value.</td>\n</tr>\n<tr>\n<td><a href=\"https://docs.mongodb.com/manual/reference/operator/update/max/#up._S_max\"><code class=\"language-text\">$max</code></a></td>\n<td>Only updates the field if the specified value is greater than the existing field value.</td>\n</tr>\n<tr>\n<td><a href=\"https://docs.mongodb.com/manual/reference/operator/update/mul/#up._S_mul\"><code class=\"language-text\">$mul</code></a></td>\n<td>Multiplies the value of the field by the specified amount.</td>\n</tr>\n<tr>\n<td><a href=\"https://docs.mongodb.com/manual/reference/operator/update/rename/#up._S_rename\"><code class=\"language-text\">$rename</code></a></td>\n<td>Renames a field.</td>\n</tr>\n<tr>\n<td><a href=\"https://docs.mongodb.com/manual/reference/operator/update/set/#up._S_set\"><code class=\"language-text\">$set</code></a></td>\n<td>Sets the value of a field in a document.</td>\n</tr>\n<tr>\n<td><a href=\"https://docs.mongodb.com/manual/reference/operator/update/setOnInsert/#up._S_setOnInsert\"><code class=\"language-text\">$setOnInsert</code></a></td>\n<td>Sets the value of a field if an update results in an insert of a document. Has no effect on update operations that modify existing documents.</td>\n</tr>\n<tr>\n<td><a href=\"https://docs.mongodb.com/manual/reference/operator/update/unset/#up._S_unset\"><code class=\"language-text\">$unset</code></a></td>\n<td>Removes the specified field from a document.</td>\n</tr>\n</tbody>\n</table>\n<p><a href=\"https://docs.mongodb.com/manual/reference/operator/update/\">https://docs.mongodb.com/manual/reference/operator/update/</a></p>\n<p>모든 task들의 completed 를 true로 바꾸기</p>\n<p>db.collection().updateMany()는 다음과 같다.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">db<span class=\"token punctuation\">.</span>collection<span class=\"token punctuation\">.</span><span class=\"token function\">updateMany</span><span class=\"token punctuation\">(</span>\n   <span class=\"token operator\">&lt;</span>filter<span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n   <span class=\"token operator\">&lt;</span>update<span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n   <span class=\"token punctuation\">{</span>\n     <span class=\"token literal-property property\">upsert</span><span class=\"token operator\">:</span> <span class=\"token operator\">&lt;</span>boolean<span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token literal-property property\">writeConcern</span><span class=\"token operator\">:</span> <span class=\"token operator\">&lt;</span>document<span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token literal-property property\">collation</span><span class=\"token operator\">:</span> <span class=\"token operator\">&lt;</span>document<span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token literal-property property\">arrayFilters</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span> <span class=\"token operator\">&lt;</span>filterdocument1<span class=\"token operator\">></span><span class=\"token punctuation\">,</span> <span class=\"token operator\">...</span> <span class=\"token punctuation\">]</span>\n   <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">)</span></code></pre></div>\n<p>위를 참고한 결과</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> updateAllTasksPromise <span class=\"token operator\">=</span> db<span class=\"token punctuation\">.</span><span class=\"token function\">collection</span><span class=\"token punctuation\">(</span><span class=\"token string\">'tasks'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">updateMany</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">$set</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">completed</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  updateAllTasksPromise\n    <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">result</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">error</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h2>Delete</h2>\n<hr>\n<p>deleteMany는 특정 조건에 부합하는 documents들을 삭제한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">db<span class=\"token punctuation\">.</span><span class=\"token function\">collection</span><span class=\"token punctuation\">(</span><span class=\"token string\">'users'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">deleteMany</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">age</span><span class=\"token operator\">:</span> <span class=\"token number\">26</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">result</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">error</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  </code></pre></div>\n<p>**deleteOne method **</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">db<span class=\"token punctuation\">.</span><span class=\"token function\">collection</span><span class=\"token punctuation\">(</span><span class=\"token string\">'tasks'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">deleteOne</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">description</span><span class=\"token operator\">:</span> <span class=\"token string\">'빨래하기'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">result</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">error</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n</code></pre></div>\n<p>CRUD 모두 단일 document에 대한 처리와 다수의 document에 대한 처리로 나뉜다. 다양한 옵션이 있는 만큼 mongodb 문서에 대한 참고가 많이 필요한 것 같다.</p>"}},"pageContext":{"slug":"Node-MongoDB-CRUD"}},
    "staticQueryHashes": ["3159585216","440568431"]}